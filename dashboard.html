<!DOCTYPE html>
<html lang="en" class="dark-mode">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GhostMarket Portal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    
    <style>
        /* --- STYLES (MATCHES ADMIN) --- */
        body { margin: 0; padding: 0; background-color: #1c1c1c; color: #bdc0c2; font-family: sans-serif; overflow-x: hidden; }
        .container-smooth { max-width: 1140px; margin: 0 auto; padding: 0 15px; }
        .entry-text { padding: 20px; }
        h3, h6, h5 { color: #ffffff; font-weight: 700; line-height: 1.5; }
        h3 { font-size: 1.75rem; text-align: center; }
        .bottom-links { display: flex; justify-content: center; margin-top: 20px; font-size: 0.9rem; flex-wrap: wrap; }
        .bottom-links a { color: #bdc0c2; margin: 0 5px; }
        .basement-hr { border-top: 1px solid #444; max-width: 425px; margin: 1rem auto; }
        .user-nav { display: flex; justify-content: flex-end; padding-top: 10px; }
        .user-badge { padding: 5px 10px; border: 1px solid #444; border-radius: 20px; font-size: 0.8rem; }
        /* Add classes used in your content that need styling (like GreenYellow) */
        .color-change { color: inherit; }
        .md-center { text-align: center; display: block; }
        .task-list { padding-left: 1.3em; }
        .force-break { word-break: break-all; }
        ul { list-style: none; padding-left: 0; }
    </style>
</head>
<body class="m-0 p-0">

    <div class="body">
        <div class="sub-body">
            <div class="container container-smooth">
                
                <div class="user-nav">
                    <span id="userDisplay" class="user-badge mr-2">Analyst Access</span>
                    <button id="logoutBtn" class="btn btn-sm btn-outline-secondary">Disconnect</button>
                </div>

                <div class="row no-gutters">
                    <div class="col-12">
                        <div class="entry-text-container">
                            <div class="entry-text">
                                <article>
                                    
                                    <div id="zone_top" style="text-align:center; font-size: 0.8rem; margin-bottom: 10px;"></div>
                                    
                                    <h3 class="md-center"><span id="block_1_header" class="md-align md-center">Loading...</span></h3>

                                    <p id="block_2_intro"></p>

                                    <h6>Our Main Services:</h6>
                                    <div id="block_3_services"></div>

                                    <h6><span style="color:LightSalmon">Our Contacts:</span></h6>
                                    <div id="block_4_contacts"></div>

                                    <h6><span style="color:GreenYellow">Six(6) Newly Flagged Bitcoin Wallets available</span></h6>
                                    <p id="block_5_wallet_info"></p>

                                    <div id="block_6_faq"></div>

                                    <h6><span style="color:GreenYellow">CURRENTLY AVAILABLE WALLETS:</span></h6>
                                    <div id="block_7_inventory"></div>

                                    <h5><span style="color:OrangeRed">Our Analysis Services Include:</span></h5>
                                    <div id="block_8_analysis"></div>

                                    <h6 style="color: #ff751b;">New Section Buffer:</h6>
                                    <div id="block_9_extra"></div>

                                </article>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center w-100 mb-3">
                    <hr class="my-2 basement-hr">
                    <div class="bottom-links">
                        <a href="#">new</a>·
                        <a href="#">what</a>·
                        <a href="#">how</a>·
                        <a href="#">contacts</a>
                        <a href="#" class="ml-1">login</a>
                    </div>
                    <div id="zone_bottom" style="font-size: 0.7rem; margin-top: 10px; color: #6c757d;"></div>
                </div>

            </div>
        </div>
    </div>

    <script>
        async function loadContent() {
            // Fetch content from the database
            const res = await fetch("/.netlify/functions/cms");
            const data = await res.json();
            const config = data.config;

            if (!config || Object.keys(config).length === 0) {
                 document.getElementById("feedContainer").innerHTML = "Error: Database config not initialized. Please visit admin.html and save the page.";
                 return;
            }

            // Map database columns to the correct HTML elements (by ID)
            document.querySelectorAll('div[id], span[id]').forEach(el => {
                const blockKey = el.id; // e.g., 'block_1_header'
                const dbKey = blockKey.replace('block_', 'block_'); // Quick conversion check, though IDs match keys

                // Ensure the block exists in the config before trying to set innerHTML
                if (config[dbKey] != null && config[dbKey].trim() !== "") {
                    el.innerHTML = config[dbKey];
                }
            });
        }

        async function initAuth() {
            // 1. Check Login Status
            const authRes = await fetch("/.netlify/functions/login-user");
            const auth = await authRes.json();
            
            if (!auth || !auth.user) { 
                window.location.href = "login.html"; 
                return; 
            }
            
            // 2. Display User and Load Content
            document.getElementById("userDisplay").textContent = "Analyst: " + auth.user.username;
            loadContent();
        }

        document.getElementById("logoutBtn").addEventListener("click", () => {
            document.cookie = "session=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
            window.location.href = "login.html";
        });
        
        initAuth();
    </script>
</body>
</html>
