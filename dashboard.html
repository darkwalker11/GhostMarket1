<!DOCTYPE html>
<html lang="en" class="dark-mode">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GhostMarket Portal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    
    <style>
        /* --- STYLES (MATCHES ADMIN) --- */
        body { margin: 0; padding: 0; background-color: #1c1c1c; color: #bdc0c2; font-family: sans-serif; overflow-x: hidden; }
        .container-smooth { max-width: 1140px; margin: 0 auto; padding: 0 15px; }
        .entry-text { padding: 20px; }
        h3, h6, h5 { color: #ffffff; font-weight: 700; line-height: 1.5; }
        h3 { font-size: 1.75rem; text-align: center; }
        
        /* Utility styles for injected content */
        .color-change { color: inherit; }
        .md-center { text-align: center; display: block; }
        ul { list-style: none; padding-left: 0; }
        .task-list { padding-left: 1.3em; }
        .task-list input { margin-right: 0.5em; vertical-align: middle; margin-left: -1.3em; }
        
        /* FOOTER */
        .user-nav { display: flex; justify-content: flex-end; padding-top: 10px; }
        .user-badge { padding: 5px 10px; border: 1px solid #444; border-radius: 20px; font-size: 0.8rem; }
    </style>
</head>
<body class="m-0 p-0">

    <div class="body">
        <div class="sub-body">
            <div class="container container-smooth">
                
                <div class="user-nav">
                    <span id="userDisplay" class="user-badge mr-2">Analyst Access</span>
                    <button id="logoutBtn" class="btn btn-sm btn-outline-secondary">Disconnect</button>
                </div>

                <div class="row no-gutters">
                    <div class="col-12 long-words">
                        <div class="entry-text-container">
                            <div class="entry-text">
                                <article>
                                    
                                    <div id="zone_top">Loading...</div>
                                    
                                    <h3 class="md-center"><span id="block_1_header">Loading...</span></h3>

                                    <p id="block_2_intro">Loading...</p>

                                    <h6>Our Main Services:</h6>
                                    <div id="block_3_services">Loading...</div>

                                    <h6><span style="color:LightSalmon">Our Contacts:</span></h6>
                                    <div id="block_4_contacts">Loading...</div>

                                    <h6><span style="color:GreenYellow">Six(6) Newly Flagged Bitcoin Wallets available</span></h6>
                                    <p id="block_5_wallet_info">Loading...</p>

                                    <div id="block_6_faq">Loading...</div>

                                    <h6><span style="color:GreenYellow">CURRENTLY AVAILABLE WALLETS:</span></h6>
                                    <div id="block_7_inventory">Loading...</div>

                                    <h5><span style="color:OrangeRed">Our Analysis Services Include:</span></h5>
                                    <div id="block_8_analysis">Loading...</div>

                                    <h6 style="color: #ff751b;">New Section Buffer:</h6>
                                    <div id="block_9_extra">Loading...</div>

                                </article>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center w-100 mb-3">
                    <hr class="my-2 basement-hr">
                    <div class="bottom-links">
                        <a href="#">new</a>·
                        <a href="#">what</a>·
                        <a href="#">how</a>·
                        <a href="#">contacts</a>
                        <a href="#" class="ml-1">login</a>
                    </div>
                    <div id="zone_bottom" style="font-size: 0.7rem; margin-top: 10px; color: #6c757d;"></div>
                </div>

            </div>
        </div>
    </div>

    <script>
        async function loadContent() {
            // Fetch content from the database
            const res = await fetch("/.netlify/functions/cms");
            const data = await res.json();
            const config = data.config;

            if (!config || Object.keys(config).length === 0) {
                 document.getElementById("block_1_header").innerHTML = "Error: Config not found. Visit admin.html and save the page.";
                 return;
            }

            // Loop through all block IDs and inject the saved HTML
            const blockIds = [
                'zone_top', 'block_1_header', 'block_2_intro', 'block_3_services', 
                'block_4_contacts', 'block_5_wallet_info', 'block_6_faq', 'block_7_inventory', 
                'block_8_analysis', 'block_9_extra', 'zone_bottom'
            ];

            blockIds.forEach((id, index) => {
                const element = document.getElementById(id);
                // Check for null or empty string before injection
                if (element && config['block_' + index] != null) {
                    element.innerHTML = config['block_' + index];
                }
            });
        }

        async function initAuth() {
            const authRes = await fetch("/.netlify/functions/login-user");
            const auth = await authRes.json();
            
            if (!auth || !auth.user) { 
                window.location.href = "login.html"; 
                return; 
            }
            
            document.getElementById("userDisplay").textContent = "Analyst: " + auth.user.username;
            loadContent();
        }

        document.getElementById("logoutBtn").addEventListener("click", () => {
            document.cookie = "session=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
            window.location.href = "login.html";
        });
        
        initAuth();
    </script>
</body>
</html>
